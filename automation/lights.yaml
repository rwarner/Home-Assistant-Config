############################
### LIGHTING AUTOMATIONS ###
############################

- id: lights_on_1hr_before_sunset
  alias: "LIGHTS - Turn on lights 1:30hr before sun sets"
  trigger:
    - platform: sun
      event: sunset
      offset: "-01:30:00"
  action:
    - service: light.turn_on
      entity_id: group.sun_based_not_home
      #Only proceed if someone is home
    - condition: state
      entity_id: group.family
      state: 'home'
    - service: light.turn_on
      entity_id: group.sun_based_home

- id: lights_off_at_1130pm
  alias: "LIGHTS - Turn off outside lights at 11:30pm"
  trigger:
    - platform: time
      at: '23:30:00'
  action:
      service: light.turn_off
      entity_id: light.outside_lights

- id: lights_off_at_9pm_all_home
  alias: "LIGHTS - Outside lights off 9:00pm, both home during week"
  trigger:
    - platform: time
      at: '21:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.family 
        state: 'home'
      - condition: time
        weekday:
          - sun
          - mon
          - tue
          - wed
          - thu
          - fri
  action:
      service: light.turn_off
      entity_id: light.outside_lights



# Turn off Unifi AP's LEDs at night
- id: unifi_light_off_1100pm
  alias: "LIGHTS - Turn off Unifi AP LED at 11:00pm"
  trigger:
    - platform: time
      at: '23:00:00'
  action:
    - service: shell_command.unifi_ap_light_off

# Turn on Unifi AP's LEDs in morning
- id: unifi_light_on_morning
  alias: "LIGHTS - Turn on Unifi AP LED in the morning"
  trigger:
    - platform: sun
      event: sunrise
      offset: "+0:30:00"
  action:
    - service: shell_command.unifi_ap_light_on


- id: front_door_motion_light
  alias: "LIGHTS - Turn on Front Porch Light, if motion detected"
  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_motion_sensor
      to: 'on'
  condition:
    - condition: state
      entity_id: light.front_porch
      state: 'off'
    - condition: time
      after: '21:00:00'
      before: '5:00:00'
  action:
    - service: light.turn_on
      entity_id: light.front_porch
    - delay: '00:03:00'
    - service: light.turn_off
      entity_id: light.front_porch

- id: rear_porch_motion_light
  alias: "LIGHTS - Turn on Rear Porch Light, if motion detected"
  trigger:
    - platform: state
      entity_id: binary_sensor.rear_porch_motion_sensor
      to: 'on'
  condition:
    - condition: state
      entity_id: light.back_porch
      state: 'off'
    - condition: time
      after: '21:00:00'
      before: '5:00:00'
  action:
    - service: light.turn_on
      entity_id: light.back_porch
    - delay: '00:03:00'
    - service: light.turn_off
      entity_id: light.back_porch
